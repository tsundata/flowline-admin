"use strict";(self.webpackChunkflowline_admin=self.webpackChunkflowline_admin||[]).push([[24],{64317:function(ve,X,r){var Z=r(1413),B=r(44925),K=r(85893),O=r(22270),$=r(67294),I=r(66758),V=r(2123),h=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],H=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],t=$.forwardRef(function(E,ee){var ae=E.fieldProps,ue=E.children,q=E.params,te=E.proFieldProps,de=E.mode,m=E.valueEnum,L=E.request,_=E.showSearch,ce=E.options,W=(0,B.Z)(E,h),re=(0,$.useContext)(I.Z);return(0,K.jsx)(V.Z,(0,Z.Z)((0,Z.Z)({valueEnum:(0,O.h)(m),request:L,params:q,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,Z.Z)({options:ce,mode:de,showSearch:_,getPopupContainer:re.getPopupContainer},ae),ref:ee,proFieldProps:te},W),{},{children:ue}))}),z=$.forwardRef(function(E,ee){var ae=E.fieldProps,ue=E.children,q=E.params,te=E.proFieldProps,de=E.mode,m=E.valueEnum,L=E.request,_=E.options,ce=(0,B.Z)(E,H),W=(0,Z.Z)({options:_,mode:de||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},ae),re=(0,$.useContext)(I.Z);return(0,K.jsx)(V.Z,(0,Z.Z)((0,Z.Z)({valueEnum:(0,O.h)(m),request:L,params:q,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,Z.Z)({getPopupContainer:re.getPopupContainer},W),ref:ee,proFieldProps:te},ce),{},{children:ue}))}),T=t,J=z,Y=T;Y.SearchSelect=J,Y.displayName="ProFormComponent",X.Z=Y},5966:function(ve,X,r){var Z=r(1413),B=r(44925),K=r(85893),O=r(2123),$=["fieldProps","proFieldProps"],I=["fieldProps","proFieldProps"],V="text",h=function(T){var J=T.fieldProps,Y=T.proFieldProps,E=(0,B.Z)(T,$);return(0,K.jsx)(O.Z,(0,Z.Z)({valueType:V,fieldProps:J,filedConfig:{valueType:V},proFieldProps:Y},E))},H=function(T){var J=T.fieldProps,Y=T.proFieldProps,E=(0,B.Z)(T,I);return(0,K.jsx)(O.Z,(0,Z.Z)({valueType:"password",fieldProps:J,proFieldProps:Y,filedConfig:{valueType:V}},E))},t=h;t.Password=H,t.displayName="ProFormComponent",X.Z=t},90672:function(ve,X,r){var Z=r(1413),B=r(44925),K=r(85893),O=r(67294),$=r(2123),I=["fieldProps","proFieldProps"],V=function(H,t){var z=H.fieldProps,T=H.proFieldProps,J=(0,B.Z)(H,I);return(0,K.jsx)($.Z,(0,Z.Z)({ref:t,valueType:"textarea",fieldProps:z,proFieldProps:T},J))};X.Z=O.forwardRef(V)},9148:function(ve,X,r){r.r(X),r.d(X,{default:function(){return ia}});var Z=r(56307),B=r.n(Z),K=r(80164),O=r.n(K),$=r(74411),I=r.n($),V=r(55559),h=r.n(V),H=r(45223),t=r.n(H),z=r(34461),T=r(8609),J=r(79508),Y=r(54549),E=r(49101),ee=r(48705),ae=r(51851),ue=r(20761),q=r(5966),te=r(90672),de=r(60415),m=r(95952),L=r(48086),_=r(60331),ce=r(4107),W=r(50146),re=r(71577),xe=r(25084),A=r(67294),Fe=r(19126),u=r(59070),Oe=r(25680),De=r.n(Oe),pe=r(92757),Te=r(62914),ye=r(79910),me=r(51446);function Se(w){return I()({id:(0,u.k$)(),type:u.Ak.AnchorType.INPUT,group:u.Ak.AnchorGroup.TOP,tooltip:"\u8F93\u5165\u6869"},w)}var Ie=(0,u.vD)(function(w){w.setRegisterHook(function(p){var o=[p.reactNodeRender.registerHook({name:"add react node",handler:function(){var i=h()(t().mark(function s(f){return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.set(pe.or,Te.E),f.set(pe.pN,ye.G);case 2:case"end":return c.stop()}},s)}));function a(s){return i.apply(this,arguments)}return a}()}),p.graphOptions.registerHook({name:"custom-x6-options",after:"dag-extension-x6-options",handler:function(){var i=h()(t().mark(function s(f){return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.grid=!1,f.keyboard={enabled:!0};case 2:case"end":return c.stop()}},s)}));function a(s){return i.apply(this,arguments)}return a}()}),p.x6Events.registerHook({name:"add",handler:function(){var i=h()(t().mark(function s(f){return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.push({eventName:"node:moved",callback:function(l,P){var n=l.node;P.executeCommand(u.cE.MOVE_NODE.id,{id:n.id,position:n.getPosition()})}},{eventName:"edge:added",callback:function(l,P){var n=l.edge.getTargetNode(),C=me.QK.getByPath(l,"options.isCommand","."),k=me.QK.getByPath(l,"options.isRenderGraph",".");!C||k||n&&P.executeCommand(u.cE.UPDATE_NODE_PORT.id,{node:n,updatePorts:function(){var v=h()(t().mark(function y(D){return t().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return R.abrupt("return",[].concat(De()(D),[Se({})]));case 1:case"end":return R.stop()}},y)}));function S(y){return v.apply(this,arguments)}return S}()})}},{eventName:"edge:removed",callback:function(l,P){var n=l.edge.getTargetCellId(),C=l.edge.getTargetPortId(),k=me.QK.getByPath(l,"options.isCommand","."),v=me.QK.getByPath(l,"options.isRenderGraph",".");!k||v||P.executeCommand(u.cE.UPDATE_NODE_PORT.id,{node:n,updatePorts:function(){var S=h()(t().mark(function D(U){var R,N;return t().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:return R=U.filter(function(ie){return ie.id!==C}),N=R.filter(function(ie){return ie.type===u.Ak.AnchorType.INPUT}),N.length===0&&R.push(Se({})),oe.abrupt("return",R);case 4:case"end":return oe.stop()}},D)}));function y(D){return S.apply(this,arguments)}return y}()})}});case 1:case"end":return c.stop()}},s)}));function a(s){return i.apply(this,arguments)}return a}()})],g=new u.K4;return g.pushAll(o),g})}),ke=r(91994),se;(function(w){var p=w.NODE_COMMON_PROPS={renderKey:pe.or,width:pe.nK,height:pe.M8},o=w.queryGraphMeta=function(){var c=h()(t().mark(function M(l){return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",I()(I()({},l),{},{flowId:l.meta.flowId}));case 1:case"end":return n.stop()}},M)}));return function(M){return c.apply(this,arguments)}}(),g=w.loadGraphData=function(){var c=h()(t().mark(function M(l){return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(l.meta.jobUID),n.next=3,(0,T.xI)({uid:l.flowId,jobUID:l.meta.jobUID});case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},M)}));return function(M){return c.apply(this,arguments)}}(),i=0,a={},s=u.yc.StatusEnum.DEFAULT,f=w.graphStatusService=h()(t().mark(function c(){return t().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return i<4?(a["node".concat(i)]={status:u.yc.StatusEnum.SUCCESS},a["node".concat(i+1)]={status:u.yc.StatusEnum.PROCESSING},i+=1,s=u.yc.StatusEnum.PROCESSING):(i=0,a.node4={status:u.yc.StatusEnum.SUCCESS},s=u.yc.StatusEnum.SUCCESS),l.abrupt("return",{graphStatus:s,statusMap:a});case 2:case"end":return l.stop()}},c)})),d=w.stopGraphStatusService=h()(t().mark(function c(){return t().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return Object.entries(a).forEach(function(P){var n=O()(P,2),C=n[1],k=C,v=k.status;v===u.yc.StatusEnum.PROCESSING&&(C.status=u.yc.StatusEnum.ERROR)}),l.abrupt("return",{graphStatus:u.yc.StatusEnum.ERROR,statusMap:a});case 2:case"end":return l.stop()}},c)}))})(se||(se={}));var Re=(0,u.s4)(function(w){w.setCommandContributions(function(){return ke.m}),w.setRegisterHookFn(function(p){var o=[p.graphMeta.registerHook({name:"get graph meta from backend",handler:function(){var i=h()(t().mark(function s(f){return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.graphMetaService=se.queryGraphMeta;case 1:case"end":return c.stop()}},s)}));function a(s){return i.apply(this,arguments)}return a}()})],g=new u.K4;return g.pushAll(o),g})}),Pe=function(p){p.executeCommandPipeline([{commandId:u.Gv.LOAD_DATA.id,getCommandOption:function(){var o=h()(t().mark(function i(){return t().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",{args:{loadDataService:se.loadGraphData}});case 1:case"end":return s.stop()}},i)}));function g(){return o.apply(this,arguments)}return g}()},{commandId:u.Gv.GRAPH_LAYOUT.id,getCommandOption:function(){var o=h()(t().mark(function i(a){var s,f;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=a.getResult(),f=s.graphData,c.abrupt("return",{args:{layoutType:"dagre",layoutOptions:{type:"dagre",rankdir:"TB",nodesep:60,ranksep:30},graphData:f}});case 2:case"end":return c.stop()}},i)}));function g(i){return o.apply(this,arguments)}return g}()},{commandId:u.Gv.GRAPH_RENDER.id,getCommandOption:function(){var o=h()(t().mark(function i(a){var s,f;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=a.getResult(),f=s.graphData,c.abrupt("return",{args:{graphData:f}});case 2:case"end":return c.stop()}},i)}));function g(i){return o.apply(this,arguments)}return g}()},{commandId:u.Gv.GRAPH_ZOOM.id,getCommandOption:function(){var o=h()(t().mark(function i(){return t().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",{args:{factor:"fit",zoomOptions:{maxScale:.9}}});case 1:case"end":return s.stop()}},i)}));function g(){return o.apply(this,arguments)}return g}()}])},he;(function(w){var p=w.id="test"})(he||(he={}));var Le=(0,u.HJ)(function(w){w.registerModel(function(p){return p.registerModel({id:he.id,getInitialValue:function(){e:;}})})}),fa=null,Ae=r(92104),Ze=r(97254),Ue=r(18094),Ne=r(36371),Ge=r(50827),$e=r(54034),Ve=r(15360),We=r(24565),e=r(85893),fe;(function(w){u.ko.set("SaveOutlined",Ae.Z),u.ko.set("CloudSyncOutlined",Ze.Z),u.ko.set("GatewayOutlined",Ue.Z),u.ko.set("GroupOutlined",Ne.Z),u.ko.set("UngroupOutlined",Ge.Z),u.ko.set("PlaySquareOutlined",$e.Z),u.ko.set("StopOutlined",Ve.Z);var p=w.getDependencies=function(){var i=h()(t().mark(function a(s){return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,u.dX.SELECTED_CELLS.getModel(s);case 2:return d.t0=d.sent,d.next=5,u.dX.GRAPH_ENABLE_MULTI_SELECT.getModel(s);case 5:return d.t1=d.sent,d.next=8,u.yc.MODEL.getModel(s);case 8:return d.t2=d.sent,d.abrupt("return",[d.t0,d.t1,d.t2]);case 10:case"end":return d.stop()}},a)}));return function(a){return i.apply(this,arguments)}}(),o=w.getToolbarState=function(){var i=h()(t().mark(function a(s){var f,d,c,M,l;return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.dX.GRAPH_ENABLE_MULTI_SELECT.useValue(s);case 2:return f=n.sent,d=f.isEnable,n.next=6,u.dX.IS_GROUP_SELECTED.useValue(s);case 6:return c=n.sent,n.next=9,u.dX.IS_NORMAL_NODES_SELECTED.useValue(s);case 9:return M=n.sent,n.next=12,u.yc.MODEL.useValue(s);case 12:return l=n.sent,n.abrupt("return",{isNodeSelected:M,isGroupSelected:c,isMultiSelectionActive:d,isProcessing:l.graphStatus===u.yc.StatusEnum.PROCESSING});case 14:case"end":return n.stop()}},a)}));return function(a){return i.apply(this,arguments)}}(),g=w.getToolbarItems=function(){var i=h()(t().mark(function a(s){var f;return t().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return f=[],f.push({id:u.ho.QUERY_GRAPH_STATUS.id+"play",tooltip:"Restart execution",iconName:"PlaySquareOutlined",isEnabled:!s.isProcessing,onClick:function(){var M=h()(t().mark(function P(n){var C;return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:C=n.commandService,C.executeCommand(u.ho.QUERY_GRAPH_STATUS.id,{graphStatusService:se.graphStatusService,loopInterval:3e3});case 2:case"end":return v.stop()}},P)}));function l(P){return M.apply(this,arguments)}return l}()}),f.push({id:u.ho.QUERY_GRAPH_STATUS.id+"stop",tooltip:"Stop execution",iconName:"StopOutlined",isEnabled:s.isProcessing,onClick:function(){var M=h()(t().mark(function P(n){var C;return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:C=n.commandService,C.executeCommand(u.ho.QUERY_GRAPH_STATUS.id,{graphStatusService:se.stopGraphStatusService,loopInterval:5e3});case 2:case"end":return v.stop()}},P)}));function l(P){return M.apply(this,arguments)}return l}(),render:function(l){return(0,e.jsx)(We.Z,{title:"Confirm stop execution\uFF1F",onConfirm:function(){l.onClick()},children:l.children})}}),c.abrupt("return",[{name:"customCmd",items:f}]);case 4:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}()})(fe||(fe={}));var Be=(0,u.iR)(function(w){w.setToolbarModelService(function(){var p=h()(t().mark(function o(g,i,a){var s,f,d;return t().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=function(){var l=h()(t().mark(function P(){var n,C;return t().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,fe.getToolbarState(i);case 2:return n=v.sent,v.next=5,fe.getToolbarItems(n);case 5:C=v.sent,g.setValue(function(S){S.mainGroups=C});case 7:case"end":return v.stop()}},P)}));return function(){return l.apply(this,arguments)}}(),M.next=3,fe.getDependencies(i);case 3:f=M.sent,d=f.map(function(l){return l.watch(h()(t().mark(function P(){return t().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:s();case 1:case"end":return C.stop()}},P)})))}),a.pushAll(d);case 6:case"end":return M.stop()}},o)}));return function(o,g,i){return p.apply(this,arguments)}}())}),ne=r(72116),Ke=r(76888),He=r(68564),Je=r(26904);function ma(w){return new Promise(function(p){return setTimeout(function(){return p(!0)},w)})}var Ye=function(){var w=h()(t().mark(function p(o){var g,i,a,s,f,d,c,M,l,P,n,C,k;return t().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return s=o.modelService,f=o.targetType,S.next=3,u.dX.GRAPH_META.useValue(s);case 3:if(d=S.sent,f!=="canvas"){S.next=6;break}return S.abrupt("return",{tabs:[{name:"DagMeta",groups:[{name:"groupName",controls:[{name:"workflowUID",label:"Workflow UID",shape:"Input",disabled:!0,required:!0,tooltip:"Workflow UID",extra:"",placeholder:"workflow uid",value:"",defaultValue:d.flowId,hidden:!1,options:[{title:"",value:""}],originData:{}},{label:"Graph data",name:"graphJSON",shape:ne.Y.EDITOR,disabled:!1,required:!0,tooltip:"JSON \u6570\u636E",placeholder:"JSON \u6570\u636E",value:"",defaultValue:"",hidden:!1,options:[{title:"",value:""}],originData:{}},{label:"View log link",name:"log",shape:ne.Y.LINKSHAPE,disabled:!1,required:!0,tooltip:"log link",placeholder:"log link",value:"",defaultValue:"",hidden:!1,options:[{title:"",value:""}],originData:{}}]}]}]});case 6:return S.next=8,(0,Ke.NQ)();case 8:return c=S.sent,S.next=11,(0,Je.Xn)();case 11:return M=S.sent,S.next=14,(0,He.Pb)();case 14:return l=S.sent,P=[],c!=null&&c.items!=null&&c.items.forEach(function(y){P.push({label:y.name,value:y.uid})}),n=[],M!=null&&M.items!=null&&M.items.forEach(function(y){n.push({label:y.name,value:y.uid})}),C=[],l!=null&&l.items!=null&&l.items.forEach(function(y){C.push({label:y.name,value:y.uid})}),k={tabs:[{name:"NodeMeta",groups:[{name:"nodeName",controls:[{label:"Code",name:"code",shape:ne.Y.SELECTOR,disabled:!0,required:!0,tooltip:"The code to be run by the compute node",placeholder:"please select code",value:(g=o.targetData)===null||g===void 0?void 0:g.code,defaultValue:"",hidden:!1,options:P,originData:{}},{label:"Variables",name:"variables",shape:ne.Y.SELECTOR,disabled:!0,required:!1,tooltip:"Variables loaded by compute nodes",placeholder:"please select connections",value:(i=o.targetData)===null||i===void 0?void 0:i.variables,defaultValue:"",hidden:!1,options:n,originData:{}},{label:"Connections",name:"connections",shape:ne.Y.SELECTOR,disabled:!0,required:!1,tooltip:"Connections loaded by compute nodes",placeholder:"please select connections",value:(a=o.targetData)===null||a===void 0?void 0:a.connections,defaultValue:"",hidden:!1,options:C,originData:{}}]}]}]},S.abrupt("return",k);case 23:case"end":return S.stop()}},p)}));return function(o){return w.apply(this,arguments)}}(),Qe=function(){var w=h()(t().mark(function p(){return t().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:case"end":return g.stop()}},p)}));return function(){return w.apply(this,arguments)}}(),ga=r(195),va=r(22970),Xe=function(p){var o=p.meta,g=Ie(p),i=Be(),a=Re(),s=Le(),f=A.useMemo(function(){return{app:null}},[]),d=function(){var c=h()(t().mark(function M(l){return t().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:f.app=l,Pe(f.app);case 2:case"end":return n.stop()}},M)}));return function(l){return c.apply(this,arguments)}}();return A.useEffect(function(){console.log(o.jobUID),f.app&&Pe(f.app)},[f,f.app,o.jobUID]),(0,e.jsxs)(u.g,{className:"dag-user-custom-clz",hookConfig:g,modelServiceConfig:s,commandConfig:a,onLoad:d,meta:{flowId:p.meta.flowId,jobUID:p.meta.jobUID},children:[(0,e.jsx)(u.ce,{}),(0,e.jsx)(u.xZ,{className:"xflow-workspace-toolbar-top",layout:"horizontal",config:i,position:{top:0,left:0,right:290,bottom:0}}),(0,e.jsxs)(u.n1,{position:{top:40,left:0,right:290,bottom:0},children:[(0,e.jsx)(u.It,{position:{top:12,right:12}}),(0,e.jsx)(u.XS,{color:"#faad14"})]}),(0,e.jsx)(u.Ip,{controlMapService:ne.O,formSchemaService:Ye,formValueUpdateService:Qe,bodyPosition:{top:0,bottom:0,right:0},position:{width:290,top:0,bottom:0,right:0},footerPosition:{height:0}})]})},ha=null,ze=function(p){var o=(0,A.useRef)(),g=(0,A.useState)(),i=O()(g,2),a=i[0],s=i[1];A.useEffect(function(){var D;(D=o.current)===null||D===void 0||D.reload()},[p.uid]);var f=(0,A.useState)(!1),d=O()(f,2),c=d[0],M=d[1],l=(0,A.useState)(!1),P=O()(l,2),n=P[0],C=P[1],k=function(){M(!0)},v=function(){C(!0)},S=function(){s(void 0),M(!1),C(!1)},y=[{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.uid",defaultMessage:"UID"}),dataIndex:"uid",tip:"The uid is the unique key"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.jobList.name",defaultMessage:"Job name"}),dataIndex:"name"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.state",defaultMessage:"State"}),dataIndex:"state",renderText:function(U){return(0,e.jsx)(_.Z,{color:"blue",children:U})}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.jobList.workflowUID",defaultMessage:"Workflow UID"}),dataIndex:"workflowUID"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.jobList.completionTimestamp",defaultMessage:"Completion time"}),dataIndex:"completionTimestamp",valueType:"dateTime"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.creationTimestamp",defaultMessage:"Created time"}),dataIndex:"creationTimestamp",valueType:"dateTime"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.titleOption",defaultMessage:"Operating"}),dataIndex:"option",valueType:"option",render:function(U,R){return[(0,e.jsx)("a",{onClick:function(){s(R),k()},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"})},"events"),(0,e.jsx)("a",{onClick:function(){s(R),v()},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.dagState",defaultMessage:"Dag state"})},"dag")]}}];return(0,e.jsxs)("div",{children:[(0,e.jsx)(ae.Z,{rowKey:"uid",search:!1,actionRef:o,request:h()(t().mark(function D(){var U;return t().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(0,Fe.qE)({uid:p.uid});case 2:return U=N.sent,N.abrupt("return",{data:U.items,success:!0});case 4:case"end":return N.stop()}},D)})),columns:y}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,visible:c,onOk:S,onCancel:S,children:a?.uid&&(0,e.jsx)(z.Z,{uid:a?.uid})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,visible:n,onOk:S,onCancel:S,children:a?.workflowUID&&(0,e.jsx)(Xe,{meta:{flowId:a?.workflowUID,jobUID:a?.uid}})})]})},qe=ze,we=r(43110),_e=r(64317),ea=function(p){var o=(0,m.useIntl)();return(0,e.jsxs)(we.L,{stepsProps:{size:"small"},stepsFormRender:function(i,a){return(0,e.jsx)(W.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:o.formatMessage({id:"pages.workflowList.form.workflowConfig",defaultMessage:"\u5DE5\u4F5C\u6D41\u914D\u7F6E"}),visible:p.updateModalVisible,footer:a,onCancel:function(){p.onCancel()},children:i})},onFinish:function(){var g=h()(t().mark(function i(a){return t().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a.trigger!="cron"){f.next=4;break}if(!(a.triggerParam==null||a.triggerParam=="")){f.next=4;break}return L.ZP.warn("\u8BF7\u8BBE\u7F6E\u5B9A\u65F6\u89C4\u5219\uFF01"),f.abrupt("return",!1);case 4:return f.next=6,p.onSubmit(I()(I()({},p.values),a));case 6:return f.abrupt("return",!0);case 7:case"end":return f.stop()}},i)}));return function(i){return g.apply(this,arguments)}}(),children:[(0,e.jsxs)(we.L.StepForm,{initialValues:{name:p.values.name,describe:p.values.describe},title:o.formatMessage({id:"pages.searchTable.updateForm.basicConfig",defaultMessage:"\u57FA\u672C\u4FE1\u606F"}),children:[(0,e.jsx)(q.Z,{name:"name",label:o.formatMessage({id:"pages.workflowList.form.name",defaultMessage:"\u5DE5\u4F5C\u6D41\u540D\u79F0"}),width:"md",rules:[{required:!0,message:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.ruleName",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u540D\u79F0\uFF01"})}]}),(0,e.jsx)(te.Z,{name:"describe",width:"md",label:o.formatMessage({id:"pages.workflowList.form.describe",defaultMessage:"\u5DE5\u4F5C\u6D41\u63CF\u8FF0"}),placeholder:o.formatMessage({id:"pages.workflowList.form.describe.descPlaceholder",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u63CF\u8FF0"}),rules:[{required:!0,message:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.form.describe.descPlaceholder",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u63CF\u8FF0\uFF01"}),min:1}]})]}),(0,e.jsxs)(we.L.StepForm,{initialValues:{trigger:p.values.trigger,triggerParam:p.values.triggerParam},title:o.formatMessage({id:"pages.workflowList.form.trigger.title",defaultMessage:"\u8BBE\u5B9A\u8C03\u5EA6\u65B9\u5F0F"}),children:[(0,e.jsx)(_e.Z,{name:"trigger",label:o.formatMessage({id:"pages.workflowList.form.trigger",defaultMessage:"\u8C03\u5EA6\u65B9\u5F0F"}),width:"md",valueEnum:{manual:o.formatMessage({id:"pages.workflowList.trigger.manual"}),cron:o.formatMessage({id:"pages.workflowList.trigger.cron"})},rules:[{required:!0,message:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.form.trigger.rule",defaultMessage:"\u8BF7\u9009\u62E9\u8C03\u5EA6\u65B9\u5F0F\uFF01"})}]}),(0,e.jsx)(q.Z,{name:"triggerParam",label:o.formatMessage({id:"pages.workflowList.form.cron",defaultMessage:"\u5B9A\u65F6\u89C4\u5219"}),width:"md",rules:[{required:!1,message:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.form.cron.rule",defaultMessage:"\u8BF7\u8F93\u5165\u5B9A\u65F6\u89C4\u5219\uFF01"})}]})]})]})},aa=ea,ta=["defaultRender"],ra=function(){var w=h()(t().mark(function p(o){var g,i,a,s;return t().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return g=L.ZP.loading("Adding"),d.prev=1,i="workflow",a="v1",s=!0,d.next=7,(0,T.g4)(I()(I()({},o),{},{kind:i,apiVersion:a,active:s}));case 7:return g(),L.ZP.success("Added successfully"),d.abrupt("return",!0);case 12:return d.prev=12,d.t0=d.catch(1),g(),L.ZP.error("Adding failed, please try again!"),d.abrupt("return",!1);case 17:case"end":return d.stop()}},p,null,[[1,12]])}));return function(o){return w.apply(this,arguments)}}(),sa=function(){var w=h()(t().mark(function p(o){var g;return t().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g=L.ZP.loading("Updating"),a.prev=1,a.next=4,(0,T.NS)({uid:o.uid},o);case 4:return g(),L.ZP.success("Update is successful"),a.abrupt("return",!0);case 9:return a.prev=9,a.t0=a.catch(1),g(),L.ZP.error("Update failed, please try again!"),a.abrupt("return",!1);case 14:case"end":return a.stop()}},p,null,[[1,9]])}));return function(o){return w.apply(this,arguments)}}(),na=function(){var w=h()(t().mark(function p(o){var g;return t().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(g=L.ZP.loading("deleting"),o){a.next=3;break}return a.abrupt("return",!0);case 3:return a.prev=3,a.next=6,(0,T.oJ)({uid:"-"});case 6:return g(),L.ZP.success("Deleted successfully and will refresh soon"),a.abrupt("return",!0);case 11:return a.prev=11,a.t0=a.catch(3),g(),L.ZP.error("Delete failed, please try again"),a.abrupt("return",!1);case 16:case"end":return a.stop()}},p,null,[[3,11]])}));return function(o){return w.apply(this,arguments)}}(),oa=function(){var p=(0,A.useState)(!1),o=O()(p,2),g=o[0],i=o[1],a=(0,A.useState)(!1),s=O()(a,2),f=s[0],d=s[1],c=(0,A.useState)(!1),M=O()(c,2),l=M[0],P=M[1],n=(0,A.useRef)(),C=(0,A.useState)(),k=O()(C,2),v=k[0],S=k[1],y=(0,A.useState)([]),D=O()(y,2),U=D[0],R=D[1],N=(0,A.useState)(!1),Me=O()(N,2),oe=Me[0],ie=Me[1],la=(0,A.useState)(!1),Ce=O()(la,2),ua=Ce[0],Ee=Ce[1],da=function(){ie(!0)},ca=function(){Ee(!0)},ge=function(){S(void 0),ie(!1),Ee(!1)},pa=(0,m.useNavigate)(),le=(0,m.useIntl)(),be=[{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.uid",defaultMessage:"UID"}),dataIndex:"uid",tip:"The uid is the unique key",render:function(j,b){return(0,e.jsx)("a",{onClick:function(){S(b),P(!0)},children:j})}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.form.workflowName.nameLabel",defaultMessage:"Workflow name"}),dataIndex:"name"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.titleDesc",defaultMessage:"Description"}),dataIndex:"describe",valueType:"textarea"},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.titleRunNo",defaultMessage:"Number of service calls"}),dataIndex:"callNo",hideInForm:!0},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.titleActive",defaultMessage:"Is active"}),dataIndex:"active",hideInForm:!0,renderText:function(j){return j?(0,e.jsx)(J.Z,{}):(0,e.jsx)(Y.Z,{})}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.titleState",defaultMessage:"Status"}),dataIndex:"state",hideInForm:!0,valueEnum:{0:{text:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.nameStatus.default",defaultMessage:"Create"}),status:"Default"},1:{text:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.nameStatus.running",defaultMessage:"Running"}),status:"Processing"},2:{text:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.nameStatus.online",defaultMessage:"Online"}),status:"Success"},3:{text:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.nameStatus.abnormal",defaultMessage:"Abnormal"}),status:"Error"}}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.trigger",defaultMessage:"Trigger"}),dataIndex:"trigger",hideInForm:!0,valueEnum:{manual:{text:(0,e.jsx)(_.Z,{color:"orange",children:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.trigger.manual",defaultMessage:"Manual"})}),status:"manual"},cron:{text:(0,e.jsx)(_.Z,{color:"blue",children:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.trigger.cron",defaultMessage:"Cron"})}),status:"cron"}}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.titleUpdatedAt",defaultMessage:"Last scheduled time"}),sorter:!0,dataIndex:"lastTriggerTimestamp",valueType:"dateTime",renderFormItem:function(j,b,x){var Q=b.defaultRender,G=B()(b,ta),je=x.getFieldValue("status");return"".concat(je)==="0"?!1:"".concat(je)==="3"?(0,e.jsx)(ce.Z,I()(I()({},G),{},{placeholder:le.formatMessage({id:"pages.searchTable.exception",defaultMessage:"Please enter the reason for the exception!"})})):Q(j)}},{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.titleOption",defaultMessage:"Operating"}),dataIndex:"option",valueType:"option",render:function(j,b){return[(0,e.jsx)("a",{onClick:function(){W.Z.confirm({title:le.formatMessage({id:"pages.workflowList.confirmSchedule",defaultMessage:"Confirm schedule now?"}),onOk:function(){L.ZP.info("\u5DF2\u5F00\u59CB\u8C03\u5EA6")}})},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.scheduleNow",defaultMessage:"Schedule now"})},"run"),(0,e.jsx)("a",{onClick:function(){d(!0),S(b)},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.searchTable.config",defaultMessage:"Configuration"})},"config"),(0,e.jsx)("a",{onClick:function(){pa("/workflow/".concat(b.uid,"/dag"),{replace:!0})},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.dag",defaultMessage:"DAG"})},"dag"),(0,e.jsx)("a",{onClick:function(){S(b),da()},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"})},"events"),(0,e.jsx)("a",{onClick:function(){S(b),ca()},children:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.jobs",defaultMessage:"Jobs"})},"jobs")]}}];return(0,e.jsxs)(ee._z,{children:[(0,e.jsx)(ae.Z,{headerTitle:le.formatMessage({id:"pages.common.tableTitle",defaultMessage:"Enquiry form"}),actionRef:n,rowKey:"uid",search:{labelWidth:120},toolBarRender:function(){return[(0,e.jsxs)(re.Z,{type:"primary",onClick:function(){i(!0)},children:[(0,e.jsx)(E.Z,{})," ",(0,e.jsx)(m.FormattedMessage,{id:"pages.common.new",defaultMessage:"New"})]},"primary")]},request:h()(t().mark(function F(){var j;return t().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,T.gI)();case 2:return j=x.sent,x.abrupt("return",{data:j.items,success:!0});case 4:case"end":return x.stop()}},F)})),columns:be,rowSelection:{onChange:function(j,b){R(b)}}}),U?.length>0&&(0,e.jsx)(ee.Sc,{extra:(0,e.jsxs)("div",{children:[(0,e.jsx)(m.FormattedMessage,{id:"pages.searchTable.chosen",defaultMessage:"Chosen"})," ",(0,e.jsx)("a",{style:{fontWeight:600},children:U.length})," ",(0,e.jsx)(m.FormattedMessage,{id:"pages.searchTable.item",defaultMessage:"\u9879"})]}),children:(0,e.jsx)(re.Z,{onClick:h()(t().mark(function F(){var j,b;return t().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,na(U);case 2:R([]),(j=n.current)===null||j===void 0||(b=j.reloadAndRest)===null||b===void 0||b.call(j);case 4:case"end":return Q.stop()}},F)})),children:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.batchDeletion",defaultMessage:"Batch deletion"})})}),(0,e.jsxs)(ue.Y,{title:le.formatMessage({id:"pages.workflowList.form.newWorkflow",defaultMessage:"New workflow"}),width:"400px",visible:g,onVisibleChange:i,onFinish:function(){var F=h()(t().mark(function j(b){var x;return t().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,ra(b);case 2:x=G.sent,x&&(i(!1),n.current&&n.current.reload());case 4:case"end":return G.stop()}},j)}));return function(j){return F.apply(this,arguments)}}(),children:[(0,e.jsx)(q.Z,{rules:[{required:!0,message:(0,e.jsx)(m.FormattedMessage,{id:"pages.workflowList.ruleName",defaultMessage:"Workflow name is required"})}],width:"md",name:"name",placeholder:le.formatMessage({id:"pages.workflowList.form.name",defaultMessage:"Workflow name"})}),(0,e.jsx)(te.Z,{width:"md",name:"describe",placeholder:le.formatMessage({id:"pages.workflowList.form.describe",defaultMessage:"Workflow describe"})})]}),(0,e.jsx)(aa,{onSubmit:function(){var F=h()(t().mark(function j(b){var x;return t().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,sa(b);case 2:x=G.sent,x&&(d(!1),S(void 0),n.current&&n.current.reload());case 4:case"end":return G.stop()}},j)}));return function(j){return F.apply(this,arguments)}}(),onCancel:function(){d(!1),l||S(void 0)},updateModalVisible:f,values:v||{}}),(0,e.jsx)(xe.Z,{width:600,visible:l,onClose:function(){S(void 0),P(!1)},closable:!1,children:v?.uid&&(0,e.jsx)(de.vY,{column:2,title:v?.uid,request:h()(t().mark(function F(){return t().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",{data:v||{}});case 1:case"end":return b.stop()}},F)})),params:{id:v?.uid},columns:be})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,visible:oe,onOk:ge,onCancel:ge,children:v?.uid&&(0,e.jsx)(z.Z,{uid:v?.uid})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(m.FormattedMessage,{id:"pages.common.jobs",defaultMessage:"Jobs"}),width:1500,visible:ua,onOk:ge,onCancel:ge,children:v?.uid&&(0,e.jsx)(qe,{uid:v?.uid})})]})},ia=oa}}]);
