"use strict";(self.webpackChunkflowline_admin=self.webpackChunkflowline_admin||[]).push([[24],{64317:function(ve,X,r){var A=r(1413),B=r(45987),K=r(85893),T=r(96202),$=r(67294),t=r(66758),V=r(69553),U=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],H=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],v=$.forwardRef(function(E,ie){var ae=E.fieldProps,le=E.children,ue=E.params,_=E.proFieldProps,re=E.mode,de=E.valueEnum,h=E.request,I=E.showSearch,ee=E.options,ce=(0,B.Z)(E,U),W=(0,$.useContext)(t.Z);return(0,K.jsx)(V.Z,(0,A.Z)((0,A.Z)({valueEnum:(0,T.h)(de),request:h,params:ue,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,A.Z)({options:ee,mode:re,showSearch:I,getPopupContainer:W.getPopupContainer},ae),ref:ie,proFieldProps:_},ce),{},{children:le}))}),z=$.forwardRef(function(E,ie){var ae=E.fieldProps,le=E.children,ue=E.params,_=E.proFieldProps,re=E.mode,de=E.valueEnum,h=E.request,I=E.options,ee=(0,B.Z)(E,H),ce=(0,A.Z)({options:I,mode:re||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},ae),W=(0,$.useContext)(t.Z);return(0,K.jsx)(V.Z,(0,A.Z)((0,A.Z)({valueEnum:(0,T.h)(de),request:h,params:ue,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,A.Z)({getPopupContainer:W.getPopupContainer},ce),ref:ie,proFieldProps:_},ee),{},{children:le}))}),F=v,J=z,Y=F;Y.SearchSelect=J,Y.displayName="ProFormComponent",X.Z=Y},5966:function(ve,X,r){var A=r(1413),B=r(45987),K=r(85893),T=r(69553),$=["fieldProps","proFieldProps"],t=["fieldProps","proFieldProps"],V="text",U=function(F){var J=F.fieldProps,Y=F.proFieldProps,E=(0,B.Z)(F,$);return(0,K.jsx)(T.Z,(0,A.Z)({valueType:V,fieldProps:J,filedConfig:{valueType:V},proFieldProps:Y},E))},H=function(F){var J=F.fieldProps,Y=F.proFieldProps,E=(0,B.Z)(F,t);return(0,K.jsx)(T.Z,(0,A.Z)({valueType:"password",fieldProps:J,proFieldProps:Y,filedConfig:{valueType:V}},E))},v=U;v.Password=H,v.displayName="ProFormComponent",X.Z=v},90672:function(ve,X,r){var A=r(1413),B=r(45987),K=r(85893),T=r(67294),$=r(69553),t=["fieldProps","proFieldProps"],V=function(H,v){var z=H.fieldProps,F=H.proFieldProps,J=(0,B.Z)(H,t);return(0,K.jsx)($.Z,(0,A.Z)({ref:v,valueType:"textarea",fieldProps:z,proFieldProps:F},J))};X.Z=T.forwardRef(V)},85835:function(ve,X,r){r.r(X),r.d(X,{default:function(){return la}});var A=r(97548),B=r.n(A),K=r(12741),T=r.n(K),$=r(97983),t=r.n($),V=r(11281),U=r.n(V),H=r(40794),v=r.n(H),z=r(62266),F=r(51178),J=r(63606),Y=r(97937),E=r(24969),ie=r(52077),ae=r(20397),le=r(62876),ue=r(78091),_=r(5966),re=r(90672),de=r(7338),h=r(36275),I=r(12461),ee=r(20550),ce=r(69677),W=r(85402),Se=r(71577),De=r(63463),Z=r(67294),Te=r(6463),u=r(88845),Fe=r(64129),ye=r.n(Fe),pe=r(30763),xe=r(37842),Ie=r(75501),me=r(88790);function Pe(w){return U()({id:(0,u.k$)(),type:u.Ak.AnchorType.INPUT,group:u.Ak.AnchorGroup.TOP,tooltip:"\u8F93\u5165\u6869"},w)}var ke=(0,u.vD)(function(w){w.setRegisterHook(function(p){var o=[p.reactNodeRender.registerHook({name:"add react node",handler:function(){var i=v()(t()().mark(function n(f){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.set(pe.or,xe.E),f.set(pe.pN,Ie.G);case 2:case"end":return c.stop()}},n)}));function a(n){return i.apply(this,arguments)}return a}()}),p.graphOptions.registerHook({name:"custom-x6-options",after:"dag-extension-x6-options",handler:function(){var i=v()(t()().mark(function n(f){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.grid=!1,f.keyboard={enabled:!0};case 2:case"end":return c.stop()}},n)}));function a(n){return i.apply(this,arguments)}return a}()}),p.x6Events.registerHook({name:"add",handler:function(){var i=v()(t()().mark(function n(f){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.push({eventName:"node:moved",callback:function(l,P){var s=l.node;P.executeCommand(u.cE.MOVE_NODE.id,{id:s.id,position:s.getPosition()})}},{eventName:"edge:added",callback:function(l,P){var s=l.edge.getTargetNode(),C=me.QK.getByPath(l,"options.isCommand","."),k=me.QK.getByPath(l,"options.isRenderGraph",".");!C||k||s&&P.executeCommand(u.cE.UPDATE_NODE_PORT.id,{node:s,updatePorts:function(){var g=v()(t()().mark(function x(y){return t()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",[].concat(ye()(y),[Pe({})]));case 1:case"end":return L.stop()}},x)}));function S(x){return g.apply(this,arguments)}return S}()})}},{eventName:"edge:removed",callback:function(l,P){var s=l.edge.getTargetCellId(),C=l.edge.getTargetPortId(),k=me.QK.getByPath(l,"options.isCommand","."),g=me.QK.getByPath(l,"options.isRenderGraph",".");!k||g||P.executeCommand(u.cE.UPDATE_NODE_PORT.id,{node:s,updatePorts:function(){var S=v()(t()().mark(function y(R){var L,G;return t()().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return L=R.filter(function(oe){return oe.id!==C}),G=L.filter(function(oe){return oe.type===u.Ak.AnchorType.INPUT}),G.length===0&&L.push(Pe({})),se.abrupt("return",L);case 4:case"end":return se.stop()}},y)}));function x(y){return S.apply(this,arguments)}return x}()})}});case 1:case"end":return c.stop()}},n)}));function a(n){return i.apply(this,arguments)}return a}()})],m=new u.K4;return m.pushAll(o),m})}),Re=r(32452),te;(function(w){var p=w.NODE_COMMON_PROPS={renderKey:pe.or,width:pe.nK,height:pe.M8},o=w.queryGraphMeta=function(){var c=v()(t()().mark(function M(l){return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",U()(U()({},l),{},{flowId:l.meta.flowId}));case 1:case"end":return s.stop()}},M)}));return function(M){return c.apply(this,arguments)}}(),m=w.loadGraphData=function(){var c=v()(t()().mark(function M(l){return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log(l.meta.jobUID),s.next=3,(0,F.xI)({uid:l.flowId,jobUID:l.meta.jobUID});case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}},M)}));return function(M){return c.apply(this,arguments)}}(),i=0,a={},n=u.yc.StatusEnum.DEFAULT,f=w.graphStatusService=v()(t()().mark(function c(){return t()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return i<4?(a["node".concat(i)]={status:u.yc.StatusEnum.SUCCESS},a["node".concat(i+1)]={status:u.yc.StatusEnum.PROCESSING},i+=1,n=u.yc.StatusEnum.PROCESSING):(i=0,a.node4={status:u.yc.StatusEnum.SUCCESS},n=u.yc.StatusEnum.SUCCESS),l.abrupt("return",{graphStatus:n,statusMap:a});case 2:case"end":return l.stop()}},c)})),d=w.stopGraphStatusService=v()(t()().mark(function c(){return t()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return Object.entries(a).forEach(function(P){var s=T()(P,2),C=s[1],k=C,g=k.status;g===u.yc.StatusEnum.PROCESSING&&(C.status=u.yc.StatusEnum.ERROR)}),l.abrupt("return",{graphStatus:u.yc.StatusEnum.ERROR,statusMap:a});case 2:case"end":return l.stop()}},c)}))})(te||(te={}));var Le=(0,u.s4)(function(w){w.setCommandContributions(function(){return Re.m}),w.setRegisterHookFn(function(p){var o=[p.graphMeta.registerHook({name:"get graph meta from backend",handler:function(){var i=v()(t()().mark(function n(f){return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:f.graphMetaService=te.queryGraphMeta;case 1:case"end":return c.stop()}},n)}));function a(n){return i.apply(this,arguments)}return a}()})],m=new u.K4;return m.pushAll(o),m})}),Ce=function(p){p.executeCommandPipeline([{commandId:u.Gv.LOAD_DATA.id,getCommandOption:function(){var o=v()(t()().mark(function i(){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",{args:{loadDataService:te.loadGraphData}});case 1:case"end":return n.stop()}},i)}));function m(){return o.apply(this,arguments)}return m}()},{commandId:u.Gv.GRAPH_LAYOUT.id,getCommandOption:function(){var o=v()(t()().mark(function i(a){var n,f;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=a.getResult(),f=n.graphData,c.abrupt("return",{args:{layoutType:"dagre",layoutOptions:{type:"dagre",rankdir:"TB",nodesep:60,ranksep:30},graphData:f}});case 2:case"end":return c.stop()}},i)}));function m(i){return o.apply(this,arguments)}return m}()},{commandId:u.Gv.GRAPH_RENDER.id,getCommandOption:function(){var o=v()(t()().mark(function i(a){var n,f;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return n=a.getResult(),f=n.graphData,c.abrupt("return",{args:{graphData:f}});case 2:case"end":return c.stop()}},i)}));function m(i){return o.apply(this,arguments)}return m}()},{commandId:u.Gv.GRAPH_ZOOM.id,getCommandOption:function(){var o=v()(t()().mark(function i(){return t()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",{args:{factor:"fit",zoomOptions:{maxScale:.9}}});case 1:case"end":return n.stop()}},i)}));function m(){return o.apply(this,arguments)}return m}()}])},he;(function(w){var p=w.id="test"})(he||(he={}));var Ze=(0,u.HJ)(function(w){w.registerModel(function(p){return p.registerModel({id:he.id,getInitialValue:function(){e:;}})})}),ma=null,Ae=r(60219),Ue=r(62548),Ge=r(29188),Ne=r(87057),$e=r(73985),Ve=r(61727),We=r(87784),Be=r(65360),e=r(85893),fe;(function(w){u.ko.set("SaveOutlined",Ae.Z),u.ko.set("CloudSyncOutlined",Ue.Z),u.ko.set("GatewayOutlined",Ge.Z),u.ko.set("GroupOutlined",Ne.Z),u.ko.set("UngroupOutlined",$e.Z),u.ko.set("PlaySquareOutlined",Ve.Z),u.ko.set("StopOutlined",We.Z);var p=w.getDependencies=function(){var i=v()(t()().mark(function a(n){return t()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,u.dX.SELECTED_CELLS.getModel(n);case 2:return d.t0=d.sent,d.next=5,u.dX.GRAPH_ENABLE_MULTI_SELECT.getModel(n);case 5:return d.t1=d.sent,d.next=8,u.yc.MODEL.getModel(n);case 8:return d.t2=d.sent,d.abrupt("return",[d.t0,d.t1,d.t2]);case 10:case"end":return d.stop()}},a)}));return function(a){return i.apply(this,arguments)}}(),o=w.getToolbarState=function(){var i=v()(t()().mark(function a(n){var f,d,c,M,l;return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,u.dX.GRAPH_ENABLE_MULTI_SELECT.useValue(n);case 2:return f=s.sent,d=f.isEnable,s.next=6,u.dX.IS_GROUP_SELECTED.useValue(n);case 6:return c=s.sent,s.next=9,u.dX.IS_NORMAL_NODES_SELECTED.useValue(n);case 9:return M=s.sent,s.next=12,u.yc.MODEL.useValue(n);case 12:return l=s.sent,s.abrupt("return",{isNodeSelected:M,isGroupSelected:c,isMultiSelectionActive:d,isProcessing:l.graphStatus===u.yc.StatusEnum.PROCESSING});case 14:case"end":return s.stop()}},a)}));return function(a){return i.apply(this,arguments)}}(),m=w.getToolbarItems=function(){var i=v()(t()().mark(function a(n){var f;return t()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return f=[],f.push({id:u.ho.QUERY_GRAPH_STATUS.id+"play",tooltip:"Restart execution",iconName:"PlaySquareOutlined",isEnabled:!n.isProcessing,onClick:function(){var M=v()(t()().mark(function P(s){var C;return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:C=s.commandService,C.executeCommand(u.ho.QUERY_GRAPH_STATUS.id,{graphStatusService:te.graphStatusService,loopInterval:3e3});case 2:case"end":return g.stop()}},P)}));function l(P){return M.apply(this,arguments)}return l}()}),f.push({id:u.ho.QUERY_GRAPH_STATUS.id+"stop",tooltip:"Stop execution",iconName:"StopOutlined",isEnabled:n.isProcessing,onClick:function(){var M=v()(t()().mark(function P(s){var C;return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:C=s.commandService,C.executeCommand(u.ho.QUERY_GRAPH_STATUS.id,{graphStatusService:te.stopGraphStatusService,loopInterval:5e3});case 2:case"end":return g.stop()}},P)}));function l(P){return M.apply(this,arguments)}return l}(),render:function(l){return(0,e.jsx)(Be.Z,{title:"Confirm stop execution\uFF1F",onConfirm:function(){l.onClick()},children:l.children})}}),c.abrupt("return",[{name:"customCmd",items:f}]);case 4:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}()})(fe||(fe={}));var Ke=(0,u.iR)(function(w){w.setToolbarModelService(function(){var p=v()(t()().mark(function o(m,i,a){var n,f,d;return t()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=function(){var l=v()(t()().mark(function P(){var s,C;return t()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,fe.getToolbarState(i);case 2:return s=g.sent,g.next=5,fe.getToolbarItems(s);case 5:C=g.sent,m.setValue(function(S){S.mainGroups=C});case 7:case"end":return g.stop()}},P)}));return function(){return l.apply(this,arguments)}}(),M.next=3,fe.getDependencies(i);case 3:f=M.sent,d=f.map(function(l){return l.watch(v()(t()().mark(function P(){return t()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:n();case 1:case"end":return C.stop()}},P)})))}),a.pushAll(d);case 6:case"end":return M.stop()}},o)}));return function(o,m,i){return p.apply(this,arguments)}}())}),ne=r(77609),He=r(77754),Je=r(85063),Ye=r(21159);function ga(w){return new Promise(function(p){return setTimeout(function(){return p(!0)},w)})}var Qe=function(){var w=v()(t()().mark(function p(o){var m,i,a,n,f,d,c,M,l,P,s,C,k;return t()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return n=o.modelService,f=o.targetType,S.next=3,u.dX.GRAPH_META.useValue(n);case 3:if(d=S.sent,f!=="canvas"){S.next=6;break}return S.abrupt("return",{tabs:[{name:"DagMeta",groups:[{name:"groupName",controls:[{name:"workflowUID",label:"Workflow UID",shape:"Input",disabled:!0,required:!0,tooltip:"Workflow UID",extra:"",placeholder:"workflow uid",value:"",defaultValue:d.flowId,hidden:!1,options:[{title:"",value:""}],originData:{}},{label:"Graph data",name:"graphJSON",shape:ne.Y.EDITOR,disabled:!1,required:!0,tooltip:"JSON \u6570\u636E",placeholder:"JSON \u6570\u636E",value:"",defaultValue:"",hidden:!1,options:[{title:"",value:""}],originData:{}},{label:"View log link",name:"log",shape:ne.Y.LINKSHAPE,disabled:!1,required:!0,tooltip:"log link",placeholder:"log link",value:"",defaultValue:"",hidden:!1,options:[{title:"",value:""}],originData:{}}]}]}]});case 6:return S.next=8,(0,He.NQ)();case 8:return c=S.sent,S.next=11,(0,Ye.Xn)();case 11:return M=S.sent,S.next=14,(0,Je.Pb)();case 14:return l=S.sent,P=[],c!=null&&c.items!=null&&c.items.forEach(function(x){P.push({label:x.name,value:x.uid})}),s=[],M!=null&&M.items!=null&&M.items.forEach(function(x){s.push({label:x.name,value:x.uid})}),C=[],l!=null&&l.items!=null&&l.items.forEach(function(x){C.push({label:x.name,value:x.uid})}),k={tabs:[{name:"NodeMeta",groups:[{name:"nodeName",controls:[{label:"Code",name:"code",shape:ne.Y.SELECTOR,disabled:!0,required:!0,tooltip:"The code to be run by the compute node",placeholder:"please select code",value:(m=o.targetData)===null||m===void 0?void 0:m.code,defaultValue:"",hidden:!1,options:P,originData:{}},{label:"Variables",name:"variables",shape:ne.Y.SELECTOR,disabled:!0,required:!1,tooltip:"Variables loaded by compute nodes",placeholder:"please select connections",value:(i=o.targetData)===null||i===void 0?void 0:i.variables,defaultValue:"",hidden:!1,options:s,originData:{}},{label:"Connections",name:"connections",shape:ne.Y.SELECTOR,disabled:!0,required:!1,tooltip:"Connections loaded by compute nodes",placeholder:"please select connections",value:(a=o.targetData)===null||a===void 0?void 0:a.connections,defaultValue:"",hidden:!1,options:C,originData:{}}]}]}]},S.abrupt("return",k);case 23:case"end":return S.stop()}},p)}));return function(o){return w.apply(this,arguments)}}(),Xe=function(){var w=v()(t()().mark(function p(){return t()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:case"end":return m.stop()}},p)}));return function(){return w.apply(this,arguments)}}(),va=r(52923),ha=r(70781),ze=function(p){var o=p.meta,m=ke(p),i=Ke(),a=Le(),n=Ze(),f=Z.useMemo(function(){return{app:null}},[]),d=function(){var c=v()(t()().mark(function M(l){return t()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:f.app=l,Ce(f.app);case 2:case"end":return s.stop()}},M)}));return function(l){return c.apply(this,arguments)}}();return Z.useEffect(function(){console.log(o.jobUID),f.app&&Ce(f.app)},[f,f.app,o.jobUID]),(0,e.jsxs)(u.g,{className:"dag-user-custom-clz",hookConfig:m,modelServiceConfig:n,commandConfig:a,onLoad:d,meta:{flowId:p.meta.flowId,jobUID:p.meta.jobUID},children:[(0,e.jsx)(u.ce,{}),(0,e.jsx)(u.xZ,{className:"xflow-workspace-toolbar-top",layout:"horizontal",config:i,position:{top:0,left:0,right:290,bottom:0}}),(0,e.jsxs)(u.n1,{position:{top:40,left:0,right:290,bottom:0},children:[(0,e.jsx)(u.It,{position:{top:12,right:12}}),(0,e.jsx)(u.XS,{color:"#faad14"})]}),(0,e.jsx)(u.Ip,{controlMapService:ne.O,formSchemaService:Qe,formValueUpdateService:Xe,bodyPosition:{top:0,bottom:0,right:0},position:{width:290,top:0,bottom:0,right:0},footerPosition:{height:0}})]})},wa=null,qe=function(p){var o=(0,Z.useRef)(),m=(0,Z.useState)(),i=T()(m,2),a=i[0],n=i[1];Z.useEffect(function(){var y;(y=o.current)===null||y===void 0||y.reload()},[p.uid]);var f=(0,Z.useState)(!1),d=T()(f,2),c=d[0],M=d[1],l=(0,Z.useState)(!1),P=T()(l,2),s=P[0],C=P[1],k=function(){M(!0)},g=function(){C(!0)},S=function(){n(void 0),M(!1),C(!1)},x=[{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.uid",defaultMessage:"UID"}),dataIndex:"uid",tip:"The uid is the unique key"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.jobList.name",defaultMessage:"Job name"}),dataIndex:"name"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.state",defaultMessage:"State"}),dataIndex:"state",renderText:function(R){return(0,e.jsx)(ee.Z,{color:R=="failed"?"orange":R=="success"?"green":"blue",children:R})}},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.jobList.workflowUID",defaultMessage:"Workflow UID"}),dataIndex:"workflowUID"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.jobList.completionTimestamp",defaultMessage:"Completion time"}),dataIndex:"completionTimestamp",valueType:"dateTime"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.creationTimestamp",defaultMessage:"Created time"}),dataIndex:"creationTimestamp",valueType:"dateTime"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.titleOption",defaultMessage:"Operating"}),dataIndex:"option",valueType:"option",render:function(R,L){return[(0,e.jsx)("a",{onClick:function(){n(L),k()},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"})},"events"),(0,e.jsx)("a",{onClick:function(){n(L),g()},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.dagState",defaultMessage:"Dag state"})},"dag")]}}];return(0,e.jsxs)("div",{children:[(0,e.jsx)(ae.Z,{rowKey:"uid",search:!1,actionRef:o,request:v()(t()().mark(function y(){var R;return t()().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,(0,Te.qE)({uid:p.uid});case 2:return R=G.sent,G.abrupt("return",{data:R.items,success:!0});case 4:case"end":return G.stop()}},y)})),columns:x}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,open:c,onOk:S,onCancel:S,children:(a==null?void 0:a.uid)&&(0,e.jsx)(z.Z,{uid:a==null?void 0:a.uid})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,open:s,onOk:S,onCancel:S,children:(a==null?void 0:a.workflowUID)&&(0,e.jsx)(ze,{meta:{flowId:a==null?void 0:a.workflowUID,jobUID:a==null?void 0:a.uid}})})]})},_e=qe,we=r(84816),ea=r(64317),aa=function(p){var o=(0,h.useIntl)();return(0,e.jsxs)(we.L,{stepsProps:{size:"small"},stepsFormRender:function(i,a){return(0,e.jsx)(W.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:o.formatMessage({id:"pages.workflowList.form.workflowConfig",defaultMessage:"\u5DE5\u4F5C\u6D41\u914D\u7F6E"}),open:p.updateModalVisible,footer:a,onCancel:function(){p.onCancel()},children:i})},onFinish:function(){var m=v()(t()().mark(function i(a){return t()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(a.trigger!="cron"){f.next=4;break}if(!(a.triggerParam==null||a.triggerParam=="")){f.next=4;break}return I.ZP.warn("\u8BF7\u8BBE\u7F6E\u5B9A\u65F6\u89C4\u5219\uFF01"),f.abrupt("return",!1);case 4:return f.next=6,p.onSubmit(U()(U()({},p.values),a));case 6:return f.abrupt("return",!0);case 7:case"end":return f.stop()}},i)}));return function(i){return m.apply(this,arguments)}}(),children:[(0,e.jsxs)(we.L.StepForm,{initialValues:{name:p.values.name,describe:p.values.describe},title:o.formatMessage({id:"pages.searchTable.updateForm.basicConfig",defaultMessage:"\u57FA\u672C\u4FE1\u606F"}),children:[(0,e.jsx)(_.Z,{name:"name",label:o.formatMessage({id:"pages.workflowList.form.name",defaultMessage:"\u5DE5\u4F5C\u6D41\u540D\u79F0"}),width:"md",rules:[{required:!0,message:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.ruleName",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u540D\u79F0\uFF01"})}]}),(0,e.jsx)(re.Z,{name:"describe",width:"md",label:o.formatMessage({id:"pages.workflowList.form.describe",defaultMessage:"\u5DE5\u4F5C\u6D41\u63CF\u8FF0"}),placeholder:o.formatMessage({id:"pages.workflowList.form.describe.descPlaceholder",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u63CF\u8FF0"}),rules:[{required:!0,message:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.form.describe.descPlaceholder",defaultMessage:"\u8BF7\u8F93\u5165\u5DE5\u4F5C\u6D41\u63CF\u8FF0\uFF01"}),min:1}]})]}),(0,e.jsxs)(we.L.StepForm,{initialValues:{trigger:p.values.trigger,triggerParam:p.values.triggerParam},title:o.formatMessage({id:"pages.workflowList.form.trigger.title",defaultMessage:"\u8BBE\u5B9A\u89E6\u53D1\u65B9\u5F0F"}),children:[(0,e.jsx)(ea.Z,{name:"trigger",label:o.formatMessage({id:"pages.workflowList.form.trigger",defaultMessage:"\u89E6\u53D1\u65B9\u5F0F"}),width:"md",valueEnum:{manual:o.formatMessage({id:"pages.workflowList.trigger.manual"}),cron:o.formatMessage({id:"pages.workflowList.trigger.cron"})},rules:[{required:!0,message:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.form.trigger.rule",defaultMessage:"\u8BF7\u9009\u62E9\u89E6\u53D1\u65B9\u5F0F\uFF01"})}]}),(0,e.jsx)(_.Z,{name:"triggerParam",label:o.formatMessage({id:"pages.workflowList.form.cron",defaultMessage:"\u5B9A\u65F6\u89C4\u5219"}),width:"md",rules:[{required:!1,message:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.form.cron.rule",defaultMessage:"\u8BF7\u8F93\u5165\u5B9A\u65F6\u89C4\u5219\uFF01"})}]})]})]})},ra=aa,ta=["defaultRender"],na=function(){var w=v()(t()().mark(function p(o){var m,i,a,n;return t()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return m=I.ZP.loading("Adding"),d.prev=1,i="workflow",a="v1",n=!0,d.next=7,(0,F.g4)(U()(U()({},o),{},{kind:i,apiVersion:a,active:n}));case 7:return m(),I.ZP.success("Added successfully"),d.abrupt("return",!0);case 12:return d.prev=12,d.t0=d.catch(1),m(),I.ZP.error("Adding failed, please try again!"),d.abrupt("return",!1);case 17:case"end":return d.stop()}},p,null,[[1,12]])}));return function(o){return w.apply(this,arguments)}}(),sa=function(){var w=v()(t()().mark(function p(o){var m;return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return m=I.ZP.loading("Updating"),a.prev=1,a.next=4,(0,F.NS)({uid:o.uid},o);case 4:return m(),I.ZP.success("Update is successful"),a.abrupt("return",!0);case 9:return a.prev=9,a.t0=a.catch(1),m(),I.ZP.error("Update failed, please try again!"),a.abrupt("return",!1);case 14:case"end":return a.stop()}},p,null,[[1,9]])}));return function(o){return w.apply(this,arguments)}}(),oa=function(){var w=v()(t()().mark(function p(o){var m;return t()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(m=I.ZP.loading("deleting"),o){a.next=3;break}return a.abrupt("return",!0);case 3:return a.prev=3,a.next=6,(0,F.oJ)({uid:"-"});case 6:return m(),I.ZP.success("Deleted successfully and will refresh soon"),a.abrupt("return",!0);case 11:return a.prev=11,a.t0=a.catch(3),m(),I.ZP.error("Delete failed, please try again"),a.abrupt("return",!1);case 16:case"end":return a.stop()}},p,null,[[3,11]])}));return function(o){return w.apply(this,arguments)}}(),ia=function(){var p=(0,Z.useState)(!1),o=T()(p,2),m=o[0],i=o[1],a=(0,Z.useState)(!1),n=T()(a,2),f=n[0],d=n[1],c=(0,Z.useState)(!1),M=T()(c,2),l=M[0],P=M[1],s=(0,Z.useRef)(),C=(0,Z.useState)(),k=T()(C,2),g=k[0],S=k[1],x=(0,Z.useState)([]),y=T()(x,2),R=y[0],L=y[1],G=(0,Z.useState)(!1),Me=T()(G,2),se=Me[0],oe=Me[1],ua=(0,Z.useState)(!1),Ee=T()(ua,2),da=Ee[0],be=Ee[1],ca=function(){oe(!0)},pa=function(){be(!0)},ge=function(){S(void 0),oe(!1),be(!1)},fa=(0,h.useNavigate)(),q=(0,h.useIntl)(),je=[{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.uid",defaultMessage:"UID"}),dataIndex:"uid",tip:"The uid is the unique key",render:function(j,b){return(0,e.jsx)("a",{onClick:function(){S(b),P(!0)},children:j})}},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.form.workflowName.nameLabel",defaultMessage:"Workflow name"}),dataIndex:"name"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.titleDesc",defaultMessage:"Description"}),dataIndex:"describe",valueType:"textarea"},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.titleActive",defaultMessage:"Is active"}),dataIndex:"active",hideInForm:!0,renderText:function(j){return j?(0,e.jsx)(J.Z,{}):(0,e.jsx)(Y.Z,{})}},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.trigger",defaultMessage:"Trigger"}),dataIndex:"trigger",hideInForm:!0,valueEnum:{manual:{text:(0,e.jsx)(ee.Z,{color:"orange",children:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.trigger.manual",defaultMessage:"Manual"})}),status:"manual"},cron:{text:(0,e.jsx)(ee.Z,{color:"blue",children:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.trigger.cron",defaultMessage:"Cron"})}),status:"cron"}}},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.titleUpdatedAt",defaultMessage:"Last scheduled time"}),sorter:!0,dataIndex:"lastTriggerTimestamp",valueType:"dateTime",renderFormItem:function(j,b,O){var Q=b.defaultRender,N=B()(b,ta),Oe=O.getFieldValue("status");return"".concat(Oe)==="0"?!1:"".concat(Oe)==="3"?(0,e.jsx)(ce.Z,U()(U()({},N),{},{placeholder:q.formatMessage({id:"pages.searchTable.exception",defaultMessage:"Please enter the reason for the exception!"})})):Q(j)}},{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.titleOption",defaultMessage:"Operating"}),dataIndex:"option",valueType:"option",render:function(j,b){return[(0,e.jsx)("a",{onClick:function(){W.Z.confirm({title:q.formatMessage({id:"pages.workflowList.confirmSchedule",defaultMessage:"Confirm schedule now?"}),onOk:function(){(0,F.Zc)({uid:b.uid}).then(function(){I.ZP.info(q.formatMessage({id:"pages.workflowList.scheduleSuccess"}))}).catch(function(){I.ZP.error(q.formatMessage({id:"pages.workflowList.scheduleFailed"}))})}})},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.scheduleNow",defaultMessage:"Schedule now"})},"run"),(0,e.jsx)("a",{onClick:function(){d(!0),S(b)},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.searchTable.config",defaultMessage:"Configuration"})},"config"),(0,e.jsx)("a",{onClick:function(){fa("/workflow/".concat(b.uid,"/dag"),{replace:!0})},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.dag",defaultMessage:"DAG"})},"dag"),(0,e.jsx)("a",{onClick:function(){S(b),ca()},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"})},"events"),(0,e.jsx)("a",{onClick:function(){S(b),pa()},children:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.jobs",defaultMessage:"Jobs"})},"jobs")]}}];return(0,e.jsxs)(ie.ZP,{children:[(0,e.jsx)(ae.Z,{headerTitle:q.formatMessage({id:"pages.common.tableTitle",defaultMessage:"Enquiry form"}),actionRef:s,rowKey:"uid",search:{labelWidth:120},toolBarRender:function(){return[(0,e.jsxs)(Se.Z,{type:"primary",onClick:function(){i(!0)},children:[(0,e.jsx)(E.Z,{})," ",(0,e.jsx)(h.FormattedMessage,{id:"pages.common.new",defaultMessage:"New"})]},"primary")]},request:v()(t()().mark(function D(){var j;return t()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,(0,F.gI)();case 2:return j=O.sent,O.abrupt("return",{data:j.items,success:!0});case 4:case"end":return O.stop()}},D)})),columns:je,rowSelection:{onChange:function(j,b){L(b)}}}),(R==null?void 0:R.length)>0&&(0,e.jsx)(le.Z,{extra:(0,e.jsxs)("div",{children:[(0,e.jsx)(h.FormattedMessage,{id:"pages.searchTable.chosen",defaultMessage:"Chosen"})," ",(0,e.jsx)("a",{style:{fontWeight:600},children:R.length})," ",(0,e.jsx)(h.FormattedMessage,{id:"pages.searchTable.item",defaultMessage:"\u9879"})]}),children:(0,e.jsx)(Se.Z,{onClick:v()(t()().mark(function D(){var j,b;return t()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:return Q.next=2,oa(R);case 2:L([]),(j=s.current)===null||j===void 0||(b=j.reloadAndRest)===null||b===void 0||b.call(j);case 4:case"end":return Q.stop()}},D)})),children:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.batchDeletion",defaultMessage:"Batch deletion"})})}),(0,e.jsxs)(ue.Y,{title:q.formatMessage({id:"pages.workflowList.form.newWorkflow",defaultMessage:"New workflow"}),width:"400px",visible:m,onVisibleChange:i,onFinish:function(){var D=v()(t()().mark(function j(b){var O;return t()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,na(b);case 2:O=N.sent,O&&(i(!1),s.current&&s.current.reload());case 4:case"end":return N.stop()}},j)}));return function(j){return D.apply(this,arguments)}}(),children:[(0,e.jsx)(_.Z,{rules:[{required:!0,message:(0,e.jsx)(h.FormattedMessage,{id:"pages.workflowList.ruleName",defaultMessage:"Workflow name is required"})}],width:"md",name:"name",placeholder:q.formatMessage({id:"pages.workflowList.form.name",defaultMessage:"Workflow name"})}),(0,e.jsx)(re.Z,{width:"md",name:"describe",placeholder:q.formatMessage({id:"pages.workflowList.form.describe",defaultMessage:"Workflow describe"})})]}),(0,e.jsx)(ra,{onSubmit:function(){var D=v()(t()().mark(function j(b){var O;return t()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,sa(b);case 2:O=N.sent,O&&(d(!1),S(void 0),s.current&&s.current.reload());case 4:case"end":return N.stop()}},j)}));return function(j){return D.apply(this,arguments)}}(),onCancel:function(){d(!1),l||S(void 0)},updateModalVisible:f,values:g||{}}),(0,e.jsx)(De.Z,{width:600,open:l,onClose:function(){S(void 0),P(!1)},closable:!1,children:(g==null?void 0:g.uid)&&(0,e.jsx)(de.vY,{column:2,title:g==null?void 0:g.uid,request:v()(t()().mark(function D(){return t()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",{data:g||{}});case 1:case"end":return b.stop()}},D)})),params:{id:g==null?void 0:g.uid},columns:je})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.events",defaultMessage:"Events"}),width:1500,open:se,onOk:ge,onCancel:ge,children:(g==null?void 0:g.uid)&&(0,e.jsx)(z.Z,{uid:g==null?void 0:g.uid})}),(0,e.jsx)(W.Z,{title:(0,e.jsx)(h.FormattedMessage,{id:"pages.common.jobs",defaultMessage:"Jobs"}),width:1500,open:da,onOk:ge,onCancel:ge,children:(g==null?void 0:g.uid)&&(0,e.jsx)(_e,{uid:g==null?void 0:g.uid})})]})},la=ia}}]);
